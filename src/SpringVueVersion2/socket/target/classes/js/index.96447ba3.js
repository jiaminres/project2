(function(e){function t(t){for(var r,o,n=t[0],l=t[1],c=t[2],d=0,p=[];d<n.length;d++)o=n[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);u&&u(t);while(p.length)p.shift()();return a.push.apply(a,c||[]),s()}function s(){for(var e,t=0;t<a.length;t++){for(var s=a[t],r=!0,n=1;n<s.length;n++){var l=s[n];0!==i[l]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=s[0]))}return e}var r={},i={index:0},a=[];function o(t){if(r[t])return r[t].exports;var s=r[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=r,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(s,r,function(t){return e[t]}.bind(null,r));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],l=n.push.bind(n);n.push=t,n=n.slice();for(var c=0;c<n.length;c++)t(n[c]);var u=l;a.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";s("85ec")},"1de4":function(e,t,s){},"34b5":function(e,t,s){},"3fd0":function(e,t,s){},4547:function(e,t,s){"use strict";s("f0ee")},4899:function(e,t,s){"use strict";s("b1ab")},"56d7":function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d");var r=s("2b0e"),i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("keep-alive",[s("router-view")],1)],1)},a=[],o=s("5530"),n=(s("ac1f"),s("5319"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"nav"}},[s("ul",{ref:"ul",attrs:{id:"funcWindow"}},[s("li",{ref:"owner",attrs:{id:"imageAndUserName"}},[s("img",{attrs:{src:e.host.headImageAddress}}),s("span",{attrs:{id:"userName"}},[e._v(e._s(e.host.userName)+"@"+e._s(e.host.userID))])]),e._l(e.items,(function(t,r){return s("li",{key:r,ref:"items",refInFor:!0},[e._v(" "+e._s(t)+" ")])}))],2)])}),l=[],c=(s("d3b7"),s("159b"),s("2f62")),u={name:"Nav",data:function(){return{items:["微信","QQ","搜索班群","客服"]}},methods:{setPadding:function(){var e=[],t=this.$refs.owner,s=this.$refs.items,r=this.$refs.ul;e.push(t),s.forEach((function(t){e.push(t)}));for(var i,a=r.clientWidth,o=0,n=0;n<e.length;n++)o+=e[n].clientWidth;i=a-o-5,i/=2*e.length;for(var l=0;l<e.length;l++){var c=parseInt(e[l].style.paddingLeft.substring(0,e[l].style.paddingLeft.length-2)),u=parseInt(e[l].style.paddingRight.substring(0,e[l].style.paddingRight.length-2));e[l].style.paddingLeft=c+i+"px",e[l].style.paddingRight=u+i+"px"}}},computed:Object(o["a"])({},Object(c["e"])("group",["host"])),mounted:function(){var e=[],t=this.$refs.owner,s=this.$refs.items;this.$refs.ul;e.push(t),s.forEach((function(t){e.push(t)}));for(var r=0;r<e.length;r++)e[r].style.paddingLeft="0px",e[r].style.paddingRight="0px";this.setPadding(),window.addEventListener("resize",this.setPadding)},beforeDestroy:function(){window.removeEventListener("resize",this.setPadding)}},d=u,p=(s("5b49"),s("2877")),g=Object(p["a"])(d,n,l,!1,null,null,null),h=g.exports,m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("User"),s("PrivateChatBox"),s("PublicChatBox")],1)},f=[],v=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"user"}},[s("ul",{attrs:{id:"userList"}},e._l(e.users,(function(t){return s("li",{key:t.userID,class:{newMsg:e.isNewMsgUser(e.full(t))},on:{click:function(s){e.sendApply(s,e.wrap(e.full(t)),e.full(t))}}},[s("img",{attrs:{src:t.headImageAddress}}),s("em",[e._v(e._s(t.userName))]),s("div",{staticClass:"mask"},[s("i",{staticClass:"isAlive",class:{alive:e.isAlive(e.full(t)),offline:!e.isAlive(e.full(t))}},[e._v(" ")])]),s("i",{directives:[{name:"show",rawName:"v-show",value:e.isApply(e.full(t)),expression:"isApply(full(user))"}],staticClass:"isApply",attrs:{"data-user":e.full(t)},on:{click:function(s){e.sendAgree(e.wrap2(e.full(t)))}}},[e._v("  ")])])})),0)])},b=[],y={name:"User",data:function(){return{color:"red"}},computed:Object(o["a"])(Object(o["a"])({},Object(c["e"])("group",["users","aliveUsers","applyUsers","agreeUsers","newMsgUsers"])),Object(c["c"])("group",["fullName"])),methods:{full:function(e){return e.userName+"@"+e.userID},isNewMsgUser:function(e){return-1!==this.newMsgUsers.indexOf(e)},isAlive:function(e){return-1!==this.aliveUsers.indexOf(e)},isApply:function(e){return-1!==this.applyUsers.indexOf(e)},wrap:function(e){if(-1===this.agreeUsers.indexOf(e)&&-1!==this.aliveUsers.indexOf(e)){var t={type:"/complex/applyConnect",text:'{"sourceUserName": "'+this.fullName+'", "targetUserName": "'+e+'"}'};return t}},wrap2:function(e){var t={type:"/complex/agreeConnect",text:'{"sourceUserName": "'+this.fullName+'", "targetUserName": "'+e+'"}'};return t},sendApply:function(e,t,s){"isApply"!==e.target.className&&-1===this.agreeUsers.indexOf(s)&&-1!==this.aliveUsers.indexOf(s)&&this.$store.dispatch("group/sendApply",t)},sendAgree:function(e){this.$store.dispatch("group/sendAgree",e)}}},x=y,I=(s("9d95"),Object(p["a"])(x,v,b,!1,null,"65183a18",null)),N=I.exports,U=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"privateChatBox"}},[s("div",{attrs:{id:"chatBox"}},[s("ShowBox"),s("UserChooseBox"),s("EditBox")],1)])},O=[],D=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"showBox",attrs:{id:"showBox"},on:{scroll:e.scrollHandler}},[s("h1",{directives:[{name:"show",rawName:"v-show",value:0===e.totalUsers.length,expression:"totalUsers.length === 0"}]},[e._v("聊天室")]),s("table",{directives:[{name:"show",rawName:"v-show",value:0===e.totalUsers.length,expression:"totalUsers.length === 0"}],attrs:{id:"defaultShowBox"}},e._l(5,(function(t){return s("tr",{key:t},e._l(5,(function(e){return s("td",{key:e})})),0)})),0),e._l(e.totalUsers,(function(t,r){return s("div",{directives:[{name:"show",rawName:"v-show",value:r===e.selected,expression:"index === selected"}],key:t},[s("div",{directives:[{name:"show",rawName:"v-show",value:-1==e.noMsg.indexOf(t)&&e.isTop(),expression:"noMsg.indexOf(totalUser) == -1 && isTop()"}],staticClass:"download"},[s("div",{staticClass:"point"}),s("div",{staticClass:"point"}),s("div",{staticClass:"point"}),s("div",{staticClass:"point"}),s("div",{staticClass:"point"}),s("div",{staticClass:"point"}),s("div",{staticClass:"point"}),s("div",{staticClass:"point"})]),e._l(e.privateMsg[t],(function(r,i){return s("div",{key:i,ref:t,refInFor:!0,class:{oppositeUser:r.sourceID!==e.host.userID,user:r.sourceID===e.host.userID}},[r.sourceID!==e.host.userID?[s("img",{staticClass:"oppositeUserImage",attrs:{src:r.headImageAddress}}),s("span",{staticClass:"oppositeUserName"},[e._v(e._s(r.userNameWithoutId))]),s("br"),s("div",{staticClass:"widthLimit"},[s("i",{staticClass:"triangle"}),s("p",{staticClass:"oppositeUserMessage"},[e._v(" "+e._s(r.message)+" ")])])]:[s("div",{ref:"bind",refInFor:!0,staticClass:"bind"},[s("span",{staticClass:"userName"},[e._v(e._s(r.userNameWithoutId))]),s("img",{staticClass:"userImage",attrs:{src:r.headImageAddress}})]),s("br"),s("div",{ref:"widthLimit",refInFor:!0,staticClass:"widthLimit"},[s("p",{ref:"userMessage",refInFor:!0,staticClass:"userMessage"},[e._v(" "+e._s(r.message)+" ")]),s("i",{staticClass:"triangle"})])]],2)}))],2)}))],2)},C=[],w=s("b85c"),_=(s("4de4"),{name:"ShowBox",data:function(){return{firstScroll:[],noMsg:[]}},computed:Object(o["a"])(Object(o["a"])({},Object(c["e"])("group",["agreeUsers","privateMsg","selected","host","room","users"])),Object(c["c"])("group",["totalUsers","fullName"])),methods:Object(o["a"])(Object(o["a"])({},Object(c["d"])("group",["updatePrivateMsgBefore"])),{},{isTop:function(){return 0===this.$refs.showBox.scrollTop&&this.$refs.showBox.scrollHeight!==this.$refs.showBox.clientHeight},style:function(e,t,s){var r=e.offsetWidth+36;r<t.clientWidth?e.style.left=t.clientWidth-r+"px":e.style.width=t.clientWidth-36-20+"px",s.style.left="calc(100% - "+s.clientWidth+"px)"},scrollHandler:function(){this.$refs.showBox;this.isTop()&&-1===this.noMsg.indexOf(this.totalUsers[this.selectedUser])&&this.getData()},getData:function(){var e=this,t=this.totalUsers[this.selected],s=t.substring(t.lastIndexOf("@")+1),r=t.substring(0,t.lastIndexOf("@"));this.$axios.get("http://localhost:8080/list/record",{params:{groupID:this.room.groupID,userID:this.host.userID,oppositeID:s,time:this.privateMsg[t][0].time}}).then((function(i){if(i.data&&i.data.length){var a,o=Object(w["a"])(i.data);try{for(o.s();!(a=o.n()).done;){var n=a.value;n.userNameWithoutId=n.sourceID===s?r:e.host.userName,n.headImageAddress=n.sourceID===s?e.users.filter((function(e){return e.userID===s}))[0].headImageAddress:e.host.headImageAddress,n.sourceName=n.userNameWithoutId+"@"+n.sourceID,n.targetName=(n.targetID===s?r:e.host.userName)+"@"+n.targetID,e.updatePrivateMsgBefore(n)}}catch(l){o.e(l)}finally{o.f()}}else e.noMsg.push(t)}))},wholeStyle:function(){if(-1===this.firstScroll.indexOf(this.totalUsers[this.selected])){this.firstScroll.push(this.totalUsers[this.selected]);var e=this.$refs[this.totalUsers[this.selected]];if(e)for(var t=e.length-1;t>=0;t--){var s=e[t];if("oppositeUser"!==s.className){var r=s.querySelector(".bind"),i=s.querySelector(".widthLimit"),a=i.querySelector(".userMessage");this.style(a,i,r)}}}}}),beforeUpdate:function(){var e=this,t=this.$refs.showBox;t.scrollHeight-t.clientHeight-t.scrollTop<5&&this.$nextTick((function(){t.scrollTop=t.scrollHeight-t.clientHeight,0!==t.scrollTop&&e.wholeStyle()}))},updated:function(){var e=this.$refs[this.totalUsers[this.selected]];if(e)for(var t=e.length-1;t>=0;t--){var s=e[t];if("oppositeUser"!==s.className){if(s.querySelector(".bind").style.left)break;var r=s.querySelector(".bind"),i=s.querySelector(".widthLimit"),a=i.querySelector(".userMessage");this.style(a,i,r)}}}}),k=_,S=(s("4899"),Object(p["a"])(k,D,C,!1,null,null,null)),j=S.exports,$=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"userChooseBox"}},[e._l(e.totalUsers,(function(t,r){return s("button",{key:t,staticClass:"user",class:{selected:e.selected===r,offline:r>e.agreeUsers.length-1},on:{click:function(t){return e.clickSelected(r)}}},[e._v(" "+e._s(t.substring(0,t.lastIndexOf("@")))+" ")])})),s("span",{ref:"laba",staticClass:"laba",on:{click:e.changeMode}},[e._v("")])],2)},M=[],A={name:"UserChooseBox",data:function(){return{public:!1}},computed:Object(o["a"])(Object(o["a"])({},Object(c["e"])("group",["agreeUsers","aliveUsers","newMsgUsers","selected"])),Object(c["c"])("group",["totalUsers"])),methods:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(c["b"])("group",["updateSelected"])),Object(c["d"])("group",["updateNewMsgUsers"])),{},{clickSelected:function(e){var t=this.totalUsers[e],s=this.newMsgUsers.filter((function(e){return e!==t}));this.updateSelected(e),this.updateNewMsgUsers(s)},changeMode:function(){this.public=!this.public;var e="",t="";this.public?(this.$refs.laba.innerText="",e="#0b0c10",t="#fff000"):(this.$refs.laba.innerText="",e="#fff",t="#000"),this.$bus.$emit("choosePublic",this.public),this.$bus.$emit("chooseColor",t),this.$bus.$emit("chooseBackGroundColor",e)}})},E=A,T=(s("6f34"),Object(p["a"])(E,$,M,!1,null,null,null)),P=T.exports,B=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"editBox"}},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.msg,expression:"msg"}],style:{color:e.color,backgroundColor:e.backgroundColor},domProps:{value:e.msg},on:{input:function(t){t.target.composing||(e.msg=t.target.value)}}}),e._v(" "),s("button",{style:{color:e.color},attrs:{id:"close"}},[e._v("关闭")]),s("button",{style:e.color,attrs:{id:"send",disabled:e.isDisabled()},on:{click:e.send}},[e._v(" 发送 ")])])},L=[],R={name:"EditBox",data:function(){return{msg:"",public:!1,color:"#000",backgroundColor:"#fff"}},computed:Object(o["a"])(Object(o["a"])({},Object(c["e"])("group",["host","room","agreeUsers","selected"])),Object(c["c"])("group",["fullName"])),methods:Object(o["a"])(Object(o["a"])({},Object(c["b"])("group",["sendPrivate","sendPublic"])),{},{isDisabled:function(){return(!this.agreeUsers.length||this.selected>this.agreeUsers.length-1)&&!this.public},send:function(){this.public?this.sendPublic(this.wrap2()):this.sendPrivate(this.wrap())},wrap:function(){var e={type:"/complex/sendMessageToUser",text:'{"groupID": "'+this.room.groupID+'", "sourceID": "'+this.host.userID+'", "targetID": "'+this.agreeUsers[this.selected].substring(this.agreeUsers[this.selected].lastIndexOf("@")+1)+'", "time": "'+Date.now()+'", "message": "'+this.msg+'" ,"targetName": "'+this.agreeUsers[this.selected]+'", "sourceName": "'+this.fullName+'", "userNameWithoutId": "'+this.host.userName+'", "headImageAddress": "'+this.host.headImageAddress+'"}'};return e},wrap2:function(){var e={type:"/simple/greeting",text:'{"userName": "'+this.fullName+'","content": "'+this.msg+'"}'};return e},clickBtn:function(){this.public?this.sendPublic(this.wrap2()):this.sendPrivate(this.wrap())}}),mounted:function(){var e=this;this.$bus.$on("choosePublic",(function(t){e.public=t})),this.$bus.$on("chooseColor",(function(t){e.color=t})),this.$bus.$on("chooseBackGroundColor",(function(t){e.backgroundColor=t}))}},H=R,W=(s("e2b7"),Object(p["a"])(H,B,L,!1,null,"12561b9f",null)),J=W.exports,q={name:"PrivateChatBox",components:{ShowBox:j,UserChooseBox:P,EditBox:J}},G=q,F=(s("4547"),Object(p["a"])(G,U,O,!1,null,null,null)),Y=F.exports,z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"publicChatBox"}},[e._m(0),s("div",{ref:"showBox",attrs:{id:"p_showBox"}},e._l(e.msgList,(function(t,r){return s("p",{key:r},[s("span",{staticStyle:{color:"red"}},[e._v(e._s(t.userName+" "))]),s("span",[e._v(e._s(t.content))])])})),0),s("div",{attrs:{id:"extraTool"}},[e._v("额外带扩展窗口")])])},Q=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"laba"}},[s("div",{attrs:{id:"signal"}},[e._v("喇叭")])])}],K={name:"PublicChatBox",data:function(){return{focus:!1}},computed:Object(o["a"])({},Object(c["e"])("group",["msgList"])),methods:{},beforeUpdate:function(){var e=this.$refs.showBox;e.scrollHeight-e.clientHeight-e.scrollTop<5&&this.$nextTick((function(){e.scrollTop=e.scrollHeight-e.clientHeight}))}},V=K,X=(s("b10a"),Object(p["a"])(V,z,Q,!1,null,null,null)),Z=X.exports,ee={name:"Body",components:{User:N,PrivateChatBox:Y,PublicChatBox:Z}},te=ee,se=(s("ed04"),Object(p["a"])(te,m,f,!1,null,null,null)),re=se.exports,ie=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("form",{attrs:{action:"/login",method:"get",id:"login"}},[s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.userID,expression:"userID",modifiers:{trim:!0}}],staticClass:"key",attrs:{type:"text",name:"userID",placeholder:" 账号"},domProps:{value:e.userID},on:{input:function(t){t.target.composing||(e.userID=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),s("br"),s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.password,expression:"password",modifiers:{trim:!0}}],staticClass:"key",attrs:{type:"password",name:"password",placeholder:" 密码"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),s("br"),s("img",{attrs:{id:"verifyCodeImg",src:e.verifyCodeImg},on:{click:e.changeImg}}),s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.verifyCodeStr,expression:"verifyCodeStr",modifiers:{trim:!0}}],attrs:{id:"verifyCodeStr",type:"text",placeholder:"请输入验证码"},domProps:{value:e.verifyCodeStr},on:{input:function(t){t.target.composing||(e.verifyCodeStr=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),s("br"),s("span",{staticStyle:{color:"red"}},[e._v(e._s(e.error))]),s("button",{attrs:{id:"submit",type:"button"},on:{click:e.login}},[e._v("登录")])])])},ae=[],oe=(s("e9c4"),{name:"Login",data:function(){return{userID:"",password:"",verifyCodeStr:"",verifyCodeImg:"http://localhost:8080/login/verifyCodeImg",error:""}},methods:Object(o["a"])(Object(o["a"])({},Object(c["b"])("group",["initHost"])),{},{changeImg:function(){this.verifyCodeImg="http://localhost:8080/login/verifyCodeImg?t="+Date.now()},login:function(){var e=this;this.userID&&this.password?this.verifyCodeStr?this.$axios.get("http://localhost:8080/login/verifyCodeStr",{params:{verifyCodeStr:this.verifyCodeStr}}).then((function(t){t.data?e.$axios.get("http://localhost:8080/login",{params:{userID:e.userID,password:e.password}}).then((function(t){if(t.data&&t.data.userID){if("0"===t.data.userID)return void(e.error="该用户已经登录,请勿重复登录");e.initHost(t.data),localStorage.setItem("login","true"),localStorage.setItem("host",JSON.stringify(t.data)),e.$router.replace({name:"group"})}else e.error="输入的密码和账号错误,请重新输入",e.changeImg()})).catch((function(t){e.error="请求发生异常,请检查网络环境"})):(e.error="验证码输入错误,请重新输入",e.changeImg())})).catch((function(t){e.error="请求发生异常，请检查网络环境"})):alert("请输入验证码"):alert("请输入账号密码")}})}),ne=oe,le=(s("9398"),Object(p["a"])(ne,ie,ae,!1,null,"4e8cd464",null)),ce=le.exports,ue=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"head"},[s("img",{attrs:{src:e.host.headImageAddress}}),s("h1",[e._v(e._s(e.host.userName))])]),s("div",{staticClass:"content"},[s("div",{staticClass:"left-menu"},[s("div",{staticClass:"group-menu",on:{click:e.gClick}},[s("div",{staticClass:"menu-head",style:{backgroundColor:e.groupClick?"#FE8333":"#fff"}},[s("img",{staticClass:"menu-head-img-open",style:{display:e.groupClick?"inline-block":"none"},attrs:{src:"image/互动.png"}}),s("img",{staticClass:"menu-head-img-close",style:{display:e.groupClick?"none":"inline-block"},attrs:{src:"image/互动白底.png"}}),s("p",{staticClass:"menu-title"},[e._v("群组")]),s("img",{staticClass:"menu-arrow-open",style:{display:e.groupClick?"inline-block":"none"},attrs:{src:"image/下拉箭头.png"}}),s("img",{staticClass:"menu-arrow-close",style:{display:e.groupClick?"none":"inline-block"},attrs:{src:"image/向右箭头.png"}})]),s("ul",{staticClass:"menu-list",style:{display:e.groupClick?"block":"none"}},[s("li",[s("router-link",{attrs:{to:"/group/block"}},[e._v("我加入的群组")])],1)])]),s("div",{staticClass:"setting-menu",on:{click:e.sClick}},[s("div",{staticClass:"menu-head",style:{backgroundColor:e.settingClick?"#FE8333":"#fff"}},[s("img",{staticClass:"menu-head-img-open",style:{display:e.settingClick?"inline-block":"none"},attrs:{src:"image/设置.png"}}),s("img",{staticClass:"menu-head-img-close",style:{display:e.settingClick?"none":"inline-block"},attrs:{src:"image/设置白底.png"}}),s("p",{staticClass:"menu-title"},[e._v("设置中心")]),s("img",{staticClass:"menu-arrow-open",style:{display:e.settingClick?"inline-block":"none"},attrs:{src:"image/下拉箭头.png"}}),s("img",{staticClass:"menu-arrow-close",style:{display:e.settingClick?"none":"inline-block"},attrs:{src:"image/向右箭头.png"}})]),s("ul",{staticClass:"menu-list",style:{display:e.settingClick?"block":"none"}},[s("li",[s("router-link",{attrs:{to:"/group/setting"}},[e._v("个人信息")])],1),s("li",[s("a",{attrs:{href:"#"},on:{click:e.reLogin}},[e._v("退出")])])])])]),s("keep-alive",[s("router-view")],1)],1)])},de=[],pe=(s("b0c0"),s("3410"),{name:"Group",data:function(){return{groupClick:!1,settingClick:!1}},computed:Object(o["a"])({},Object(c["e"])("group",["host"])),methods:Object(o["a"])(Object(o["a"])({},Object(c["b"])("group",["disconnect","destroyMsg","destroyHost"])),{},{gClick:function(){this.groupClick=!this.groupClick},sClick:function(){this.settingClick=!this.settingClick},reLogin:function(){localStorage.clear(),this.offLine()},offLine:function(){var e=this;this.$axios.get("http://localhost:8080/offLine",{params:{userID:this.host.userID}}).then((function(t){e.$router.replace({name:"login"})})).catch((function(e){alert("网络错误\n"+e.message)}))}}),beforeRouteLeave:function(e,t,s){"native"!==e.name&&(Object.getPrototypeOf(Ve).$axios.get("http://localhost:8080/offLine",{params:{userID:Ve.$store.state.group.host.userID}}),Ve.$store.state.group.host={},Ve.$store.dispatch("group/destroyMsg"),localStorage.clear()),s()},beforeRouteEnter:function(e,t,s){if(Ve)return Ve.$store.state.group.host.userID?void s():(alert("你还没有登录"),void Ve.$router.replace({name:"login"}))}}),ge=pe,he=(s("a99a"),Object(p["a"])(ge,ue,de,!1,null,null,null)),me=he.exports,fe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Nav"),s("Body")],1)},ve=[],be={name:"Native",components:{Nav:h,Body:re},props:["groupID","leaderID","groupName","headImageAddress"],computed:Object(o["a"])({},Object(c["e"])("group",["host","room","users"])),methods:Object(o["a"])(Object(o["a"])({},Object(c["b"])("group",["initUsers","initRoom","connect","disconnect","destroyData","destroyMsg"])),Object(c["d"])("group",["updatePrivateMsg"])),activated:function(){var e=this,t=!1;this.room.groupID!==this.groupID&&(this.destroyMsg(),t=!0),this.$axios.get("http://localhost:8080/list/user",{params:{userID:this.host.userID,groupID:this.groupID}}).then((function(s){if(s.data){if(e.destroyData(),e.initRoom({groupID:e.groupID,leaderID:e.leaderID,groupName:e.groupName,headImageAddress:e.headImageAddress}),e.initUsers(s.data),t){var r,i=Object(w["a"])(e.users);try{var a=function(){var t=r.value;e.$axios.get("http://localhost:8080/list/record",{params:{groupID:e.room.groupID,userID:e.host.userID,oppositeID:t.userID,time:Date.now()}}).then((function(s){if(s.data&&s.data.length)for(var r=s.data.length-1;r>=0;r--){var i=s.data[r];i.userNameWithoutId=i.sourceID==t.userID?t.userName:e.host.userName,i.headImageAddress=i.sourceID==t.userID?t.headImageAddress:e.host.headImageAddress,i.sourceName=i.userNameWithoutId+"@"+i.sourceID,i.targetName=(i.targetID==t.userID?t.userName:e.host.userName)+"@"+i.targetID,e.updatePrivateMsg(i)}else;}))};for(i.s();!(r=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}}e.connect()}else alert("获取群组列表失败"),e.$router.replace({name:"group"})})).catch((function(t){e.error="请求发生异常，请检查网络环境",e.$router.replace({name:"group"})}))},deactivated:function(){this.destroyData(),this.disconnect()},beforeRouteEnter:function(e,t,s){if(Ve)return Ve.$store.state.group.host.userID?void s():(alert("你还没有登录"),void Ve.$router.replace({name:"login"}))}},ye=be,xe=Object(p["a"])(ye,fe,ve,!1,null,null,null),Ie=xe.exports,Ne={name:"App",data:function(){return{}},methods:Object(o["a"])(Object(o["a"])({},Object(c["b"])("group",["initHost","destroyHost"])),{},{toGroup:function(){var e=this;if(localStorage.getItem("login")){var t=JSON.parse(localStorage.getItem("host"));this.$axios.get("http://localhost:8080/login",{params:{userID:t.userID,password:t.password}}).then((function(s){s.data&&s.data.userID?"0"===s.data.userID?(alert("已登录，请勿重复登录"),e.$router.replace({name:"login"})):(e.initHost(t),e.$router.replace({name:"group"})):(localStorage.clear(),alert("验证过期,请重新登录"),e.$router.replace({name:"login"}))})).catch((function(t){alert("网络异常\n"+t.message),localStorage.clear(),e.$router.replace({name:"login"})}))}else this.$router.replace({name:"login"})}}),computed:Object(o["a"])({},Object(c["e"])("group",["host"])),components:{Nav:h,Body:re,Login:ce,Group:me,Native:Ie},mounted:function(){var e=this;console.log("mounted"),window.onbeforeunload=function(){e.host.userID&&e.$axios.get("http://localhost:8080/offLine",{params:{userID:e.host.userID}}),e.$store.dispatch("group/disconnect"),e.destroyHost()},this.toGroup()}},Ue=Ne,Oe=(s("034f"),Object(p["a"])(Ue,i,a,!1,null,null,null)),De=Oe.exports,Ce=(s("99af"),{namespaced:!0,actions:{initRoom:function(e,t){e.commit("INITROOM",t)},initHost:function(e,t){e.commit("INITHOST",t)},initUsers:function(e,t){e.commit("INITUSERS",t)},initGroups:function(e,t){e.commit("INITGROUPS",t)},updateSelected:function(e,t){e.commit("UPDATESELECTED",t)},connect:function(e){if(window.WebSocket){var t={};t=new WebSocket("ws://localhost/ws"),t.onopen=function(){t.send(JSON.stringify({type:"/simple/welcome",text:'{"userName": "'+e.getters.fullName+'"}'}))},t.onclose=function(e){},t.onmessage=function(s){var r=JSON.parse(s.data),i=r.type;if("/simple/greeting"===i)e.commit("updateMsgList",r.text);else if("/simple/welcome"===i){if(r.text.userName===e.getters.fullName)return;e.commit("updateAliveUsers",r.text.userName),e.commit("updateMsgList",{userName:r.text.userName+"上线了@",content:""}),t.send(JSON.stringify({type:"/simple/youAreWelcome",text:'{"userName": "'+e.getters.fullName+'"}'}))}else if("/simple/exit"===i){var a=e.getters.totalUsers[e.state.selected];-1!==e.state.agreeUsers.indexOf(r.text.userName)&&(e.commit("updateRecordUsers",r.text.userName),e.commit("updateAgreeUsers",e.state.agreeUsers.filter((function(e){return e!==r.text.userName})))),a===r.text.userName?e.commit("UPDATESELECTED",e.state.agreeUsers.length-1):e.commit("UPDATESELECTED",e.getters.totalUsers.indexOf(a)),e.commit("updateAliveUsers",e.state.aliveUsers.filter((function(e){return e!==r.text.userName}))),e.commit("updateApplyUsers",e.state.applyUsers.filter((function(e){return e!==r.text.userName}))),e.commit("updateMsgList",{userName:r.text.userName+"下线了@",content:""})}else if("/simple/youAreWelcome"===i){if(r.text.userName===e.getters.fullName)return;if(-1!==e.state.aliveUsers.indexOf(r.text.userName))return;e.commit("updateAliveUsers",r.text.userName)}else if(i==="/user/"+e.getters.fullName+"/simple/applyConnect"){if(-1!==e.state.applyUsers.indexOf(r.text.sourceUserName))return;e.commit("updateApplyUsers",r.text.sourceUserName)}else if(i==="/user/"+e.getters.fullName+"/simple/agreeConnect")e.commit("updateRecordUsers",e.state.recordUsers.filter((function(e){return e!==r.text.sourceUserName}))),e.commit("updateApplyUsers",e.state.applyUsers.filter((function(e){return e!==r.text.sourceUserName}))),e.commit("updateAgreeUsers",r.text.sourceUserName);else if(i==="/user/"+e.getters.fullName+"/simple/sendMessageToUser"){if(e.commit("updatePrivateMsg",r.text),r.text.sourceName===e.state.agreeUsers[e.state.selected])return;if(-1!==e.state.newMsgUsers.indexOf(r.text.sourceName))return;e.commit("updateNewMsgUsers",r.text.sourceName)}},e.commit("updateSocket",t)}else alert("该浏览器不支持WebSocket,请更换浏览器重新打开网址")},disconnect:function(e){null!==e.state.socket&&e.state.socket.send&&(e.state.socket.send(JSON.stringify({type:"/simple/exit",text:'{"userName": "'+e.getters.fullName+'"}'})),e.state.socket.close(),e.state.socket={})},destroyHost:function(e){e.commit("DESTROYHOST")},destroyData:function(e){e.commit("DESTROYDATA")},destroyMsg:function(e){e.commit("DESTROYMSG")},sendPrivate:function(e,t){e.state.socket.send(JSON.stringify(t)),e.commit("updatePrivateMsg",JSON.parse(t.text))},sendPublic:function(e,t){e.state.socket.send(JSON.stringify(t))},sendApply:function(e,t){e.state.socket.send(JSON.stringify(t))},sendAgree:function(e,t){e.state.socket.send(JSON.stringify(t));var s=JSON.parse(t.text).targetUserName;e.commit("deleteApplyUsers",s),e.commit("updateAgreeUsers",s),e.commit("updateRecordUsers",e.state.recordUsers.filter((function(e){return e!==s})))}},mutations:{DESTROYHOST:function(e){e.host={}},DESTROYDATA:function(e){e.aliveUsers=[],e.applyUsers=[],e.agreeUsers=[],e.recordUsers=[],e.totalUsers=[],e.newMsgUsers=[],e.selected=0},DESTROYMSG:function(e){e.msgList=[],e.room={},e.privateMsg={}},UPDATESELECTED:function(e,t){e.selected=t},INITROOM:function(e,t){e.room=t},INITUSERS:function(e,t){e.users=t},INITHOST:function(e,t){e.host=t},INITGROUPS:function(e,t){e.groups=t},updateDetail:function(e,t,s,r,i,a){e.host.detail.sex=t,e.host.detail.age=s,e.host.detail.birthday=r,e.host.detail.location=i,e.host.detail.persionalSign=a},updateSocket:function(e,t){e.socket=t},updateMsgList:function(e,t){t.userName=t.userName.substring(0,t.userName.lastIndexOf("@")),e.msgList.push(t)},updateAliveUsers:function(e,t){t instanceof Array?e.aliveUsers=t:e.aliveUsers.push(t)},updateApplyUsers:function(e,t){t instanceof Array?e.applyUsers=t:e.applyUsers.push(t)},deleteApplyUsers:function(e,t){e.applyUsers=e.applyUsers.filter((function(e){return e!==t}))},updateAgreeUsers:function(e,t){t instanceof Array?e.agreeUsers=t:e.agreeUsers.push(t)},updateNewMsgUsers:function(e,t){t instanceof Array?e.newMsgUsers=t:e.newMsgUsers.push(t)},updateRecordUsers:function(e,t){t instanceof Array?e.recordUsers=t:e.recordUsers.push(t)},deleteAgreeUsers:function(e,t){e.agreeUsers=e.agreeUsers.filter((function(e){}))},updatePrivateMsgBefore:function(e,t){console.log(e),console.log(t),t.sourceID!==e.host.userID?e.privateMsg[t.sourceName].unshift(t):e.privateMsg[t.targetName].unshift(t)},updatePrivateMsg:function(e,t){t.sourceID!==e.host.userID?(e.privateMsg[t.sourceName]||r["a"].set(e.privateMsg,t.sourceName,[]),e.privateMsg[t.sourceName].push(t)):(e.privateMsg[t.targetName]||r["a"].set(e.privateMsg,t.targetName,[]),e.privateMsg[t.targetName].push(t))}},state:{host:{},room:{},users:[],groups:[],socket:{},msgList:[],aliveUsers:[],applyUsers:[],agreeUsers:[],recordUsers:[],totalUsers:[],newMsgUsers:[],privateMsg:{},selected:0},getters:{fullName:function(e){return e.host.userName+"@"+e.host.userID},totalUsers:function(e){return e.agreeUsers.concat(e.recordUsers)}}});r["a"].use(c["a"]);var we=new c["a"].Store({modules:{group:Ce}}),_e=s("bc3a"),ke=s.n(_e),Se=s("8c4f"),je=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"b"},[s("div",{staticStyle:{height:"50px","line-height":"50px"}},[s("h1",{staticClass:"ti"},[e._v("我加入的群组")]),s("p",{staticClass:"join-total"},[e._v(e._s(e.groups.length))])]),s("hr"),""!=e.msg?s("h1",{staticClass:"msg"},[e._v(e._s(e.msg))]):e._e(),e._l(e.groups,(function(t){return s("div",{key:t.groupID,staticClass:"g"},[s("router-link",{attrs:{to:{name:"native",query:{groupID:t.groupID,leaderID:t.leaderID,groupName:t.groupName,headImageAddress:t.headImageAddress}}}},[s("img",{attrs:{src:t.headImageAddress}})]),s("router-link",{attrs:{to:{name:"native",query:{groupID:t.groupID,leaderID:t.leaderID,groupName:t.groupName,headImageAddress:t.headImageAddress}}}},[s("h1",[e._v(e._s(t.groupName))])])],1)}))],2)},$e=[],Me={name:"Block",data:function(){return{msg:"",init:!1}},methods:Object(o["a"])({},Object(c["b"])("group",["initGroups"])),computed:Object(o["a"])({},Object(c["e"])("group",["groups","host","users"])),activated:function(){var e=this;this.init||this.$axios.get("http://localhost:8080/list/group",{params:{userID:this.host.userID}}).then((function(t){t.data?e.initGroups(t.data):e.msg="你没有加入任何群组",e.init=!0})).catch((function(t){e.msg="请求出现异常,请检查网络环境"}))}},Ae=Me,Ee=(s("c4e0"),Object(p["a"])(Ae,je,$e,!1,null,"36376cfb",null)),Te=Ee.exports,Pe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"setting"},[s("ul",[s("li",[s("img",{attrs:{id:"head",src:e.host.headImageAddress}}),s("div",{attrs:{id:"persion"}},[s("span",{attrs:{id:"name"}},[e._v(e._s(e.host.userName))]),s("br"),s("span",{attrs:{id:"userID"}},[e._v(e._s(e.host.userID))])]),s("i",{staticClass:"triangle",on:{click:e.skipToEdit}})]),s("li",[s("span",[e._v("")]),s("span",{class:{noMsg:!e.host.detail.sex}},[e._v(e._s(e.host.detail.sex?e.host.detail.sex:"性别"))]),s("i",{staticClass:"line"}),s("span",{class:{noMsg:!e.host.detail.age}},[e._v(e._s(e.host.detail.age?e.host.detail.age:"年龄"))]),s("i",{staticClass:"line"}),s("span",{class:{noMsg:!e.host.detail.birthday}},[e._v(e._s(e.host.detail.birthday?e.getBirthday(e.host.detail.birthday):"出生日期"))]),s("i",{staticClass:"line"}),s("span",{class:{noMsg:!e.host.detail.location}},[e._v(e._s(e.host.detail.location?e.host.detail.location:"居住地址"))]),s("i",{staticClass:"triangle",on:{click:e.skipToEdit}})]),s("li",[s("span",[e._v("")]),s("span",{class:{noMsg:!e.host.detail.persionalSign}},[e._v(e._s(e.host.detail.persionalSign?e.host.detail.persionalSign:"个性签名"))]),s("i",{staticClass:"triangle",on:{click:e.skipToEdit}})]),s("li",[s("span",[e._v("xx")]),s("i",{staticClass:"triangle",on:{click:e.skipToEdit}})]),s("li",[s("span",[e._v("xx")]),s("i",{staticClass:"triangle",on:{click:e.skipToEdit}})])])])},Be=[],Le={name:"Setting",data:function(){return{}},methods:{skipToEdit:function(){this.$router.replace({name:"edit"})},getBirthday:function(e){var t=new Date(e);return t.getFullYear()+"年"+t.getMonth()+"月"+t.getDay()+"日"}},computed:Object(o["a"])({},Object(c["e"])("group",["host"]))},Re=Le,He=(s("c70a"),Object(p["a"])(Re,Pe,Be,!1,null,"2164f02c",null)),We=He.exports,Je=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"edit"},[s("div",{attrs:{id:"head"}},[s("div",{staticClass:"triangle",on:{click:e.skipToSetting}}),e._v(" 详细资料 ")]),s("ul",[s("li",[e._v(" 性别"),s("input",{directives:[{name:"model",rawName:"v-model",value:e.sex,expression:"sex"}],attrs:{type:"text",placeholder:"编辑你的性别"},domProps:{value:e.sex},on:{input:function(t){t.target.composing||(e.sex=t.target.value)}}})]),s("hr"),s("li",[e._v(" 年龄"),s("input",{directives:[{name:"model",rawName:"v-model",value:e.age,expression:"age"}],attrs:{type:"text",placeholder:"编辑你的年龄"},domProps:{value:e.age},on:{input:function(t){t.target.composing||(e.age=t.target.value)}}})]),s("hr"),s("li",[e._v(" 生日"),s("input",{directives:[{name:"model",rawName:"v-model",value:e.birthday,expression:"birthday"}],attrs:{type:"date",placeholder:"编辑你的生日"},domProps:{value:e.birthday},on:{input:function(t){t.target.composing||(e.birthday=t.target.value)}}})]),s("hr"),s("li",[e._v(" 用户地址"),s("input",{directives:[{name:"model",rawName:"v-model",value:e.location,expression:"location"}],attrs:{type:"text",placeholder:"编辑你的地址"},domProps:{value:e.location},on:{input:function(t){t.target.composing||(e.location=t.target.value)}}})]),s("hr"),s("li",[e._v(" 个性签名"),s("input",{directives:[{name:"model",rawName:"v-model",value:e.persionalSign,expression:"persionalSign"}],attrs:{type:"text",placeholder:"编辑你的个性签名"},domProps:{value:e.persionalSign},on:{input:function(t){t.target.composing||(e.persionalSign=t.target.value)}}})])]),s("button",{attrs:{id:"editBtn",type:"button"},on:{click:e.modifyDetail}},[e._v("修改资料")])])},qe=[],Ge={name:"Edit",data:function(){return{sex:"",age:"",birthday:"",location:"",persionalSign:""}},updated:function(){console.log(this.birthday)},computed:Object(o["a"])({},Object(c["e"])("group",["host"])),methods:Object(o["a"])(Object(o["a"])({},Object(c["d"])("group",["updateDetail"])),{},{skipToSetting:function(){this.$router.replace({name:"setting"})},modifyDetail:function(){var e=this;this.sex!==this.host.detail.sex||this.age!==this.host.detail.age||this.birthday&&new Date(this.birthday).getTime()!==this.host.detail.birthday||this.location!==this.host.detail.location||this.persionalSign!==this.host.detail.persionalSign?this.$axios.get("http://localhost:8080/detail/put",{params:{sex:this.sex,age:this.age,birthday:this.birthday,location:this.location,persionalSign:this.persionalSign}}).then((function(t){!0!==t.data?alert("更新失败\n"+t.message):(alert("更新成功"),e.updateDetail(e.sex,e.age,e.birthday?null:new Date(birthday).getTime(),e.location,e.persionalSign))})).catch((function(e){alert("网络错误\n"+e.message)})):alert("你没有更改任何信息")}}),activated:function(){var e=new Date(this.host.detail.birthday);this.sex=this.host.detail.sex,this.age=this.host.detail.age,this.birthday=e.getFullYear()+"-"+(e.getMonth()+1<=9?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDay()<=9?"0"+e.getDay():e.getDay()),this.location=this.host.detail.location,this.persionalSign=this.host.detail.persionalSign}},Fe=Ge,Ye=(s("b9cd"),Object(p["a"])(Fe,Je,qe,!1,null,"5eef822a",null)),ze=Ye.exports;r["a"].use(Se["a"]);var Qe=new Se["a"]({routes:[{name:"login",path:"/login",component:ce},{name:"native",path:"/native",component:Ie,props:function(e){return{groupID:e.query.groupID,leaderID:e.query.leaderID,groupName:e.query.groupName,headImageAddress:e.query.headImageAddress}},beforeEnter:function(e,t,s){localStorage.getItem("login")&&"true"===localStorage.getItem("login")?s():alert("请先登录")}},{name:"group",path:"/group",component:me,children:[{name:"block",path:"block",component:Te},{name:"setting",path:"setting",component:We},{name:"edit",path:"edit",component:ze}],beforeEnter:function(e,t,s){localStorage.getItem("login")&&"true"===localStorage.getItem("login")?s():alert("请先登录")}}]}),Ke=Qe;r["a"].config.productionTip=!1,ke.a.defaults.withCredentials=!0;var Ve=t["default"]=new r["a"]({el:"#app",store:we,render:function(e){return e(De)},router:Ke,beforeCreate:function(){r["a"].prototype.$bus=this,r["a"].prototype.$axios=ke.a}})},"58de":function(e,t,s){},"5b49":function(e,t,s){"use strict";s("58de")},"6e32":function(e,t,s){},"6f34":function(e,t,s){"use strict";s("9d09")},"71da":function(e,t,s){},"85ec":function(e,t,s){},9398:function(e,t,s){"use strict";s("34b5")},"9c5e":function(e,t,s){},"9d09":function(e,t,s){},"9d95":function(e,t,s){"use strict";s("9c5e")},a99a:function(e,t,s){"use strict";s("cbf4")},b10a:function(e,t,s){"use strict";s("6e32")},b1ab:function(e,t,s){},b9cd:function(e,t,s){"use strict";s("71da")},c4e0:function(e,t,s){"use strict";s("3fd0")},c70a:function(e,t,s){"use strict";s("1de4")},cbf4:function(e,t,s){},db6a:function(e,t,s){},e2b7:function(e,t,s){"use strict";s("fea3")},ed04:function(e,t,s){"use strict";s("db6a")},f0ee:function(e,t,s){},fea3:function(e,t,s){}});
//# sourceMappingURL=index.96447ba3.js.map