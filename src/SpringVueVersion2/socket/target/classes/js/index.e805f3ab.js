(function(e){function t(t){for(var r,o,n=t[0],c=t[1],u=t[2],d=0,p=[];d<n.length;d++)o=n[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(p.length)p.shift()();return a.push.apply(a,u||[]),s()}function s(){for(var e,t=0;t<a.length;t++){for(var s=a[t],r=!0,n=1;n<s.length;n++){var c=s[n];0!==i[c]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=s[0]))}return e}var r={},i={index:0},a=[];function o(t){if(r[t])return r[t].exports;var s=r[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=r,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(s,r,function(t){return e[t]}.bind(null,r));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],c=n.push.bind(n);n.push=t,n=n.slice();for(var u=0;u<n.length;u++)t(n[u]);var l=c;a.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";s("85ec")},"3fd0":function(e,t,s){},4547:function(e,t,s){"use strict";s("f0ee")},4899:function(e,t,s){"use strict";s("b1ab")},"56d7":function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d");var r=s("2b0e"),i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.host.userName?e._e():s("Login"),s("keep-alive",[s("router-view")],1)],1)},a=[],o=s("5530"),n=(s("ac1f"),s("5319"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"nav"}},[s("ul",{ref:"ul",attrs:{id:"funcWindow"}},[s("li",{ref:"owner",attrs:{id:"imageAndUserName"}},[s("img",{attrs:{src:e.host.headImageAddress}}),s("span",{attrs:{id:"userName"}},[e._v(e._s(e.host.userName)+"@"+e._s(e.host.userID))])]),e._l(e.items,(function(t,r){return s("li",{key:r,ref:"items",refInFor:!0},[e._v(" "+e._s(t)+" ")])}))],2)])}),c=[],u=(s("d3b7"),s("159b"),s("2f62")),l={name:"Nav",data:function(){return{items:["微信","QQ","搜索班群","客服"]}},methods:{setPadding:function(){var e=[],t=this.$refs.owner,s=this.$refs.items,r=this.$refs.ul;e.push(t),s.forEach((function(t){e.push(t)}));for(var i,a=r.clientWidth,o=0,n=0;n<e.length;n++)o+=e[n].clientWidth;i=a-o-5,i/=2*e.length;for(var c=0;c<e.length;c++){var u=parseInt(e[c].style.paddingLeft.substring(0,e[c].style.paddingLeft.length-2)),l=parseInt(e[c].style.paddingRight.substring(0,e[c].style.paddingRight.length-2));e[c].style.paddingLeft=u+i+"px",e[c].style.paddingRight=l+i+"px"}}},computed:Object(o["a"])({},Object(u["e"])("group",["host"])),mounted:function(){var e=[],t=this.$refs.owner,s=this.$refs.items;this.$refs.ul;e.push(t),s.forEach((function(t){e.push(t)}));for(var r=0;r<e.length;r++)e[r].style.paddingLeft="0px",e[r].style.paddingRight="0px";this.setPadding(),window.addEventListener("resize",this.setPadding)},beforeDestroy:function(){window.removeEventListener("resize",this.setPadding)}},d=l,p=(s("5b49"),s("2877")),m=Object(p["a"])(d,n,c,!1,null,null,null),f=m.exports,g=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("User"),s("PrivateChatBox"),s("PublicChatBox")],1)},h=[],v=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"user"}},[s("ul",{attrs:{id:"userList"}},e._l(e.users,(function(t){return s("li",{key:t.userID,class:{newMsg:e.isNewMsgUser(e.full(t))},on:{click:function(s){e.sendApply(s,e.wrap(e.full(t)),e.full(t))}}},[s("img",{attrs:{src:t.headImageAddress}}),s("em",[e._v(e._s(t.userName))]),s("div",{staticClass:"mask"},[s("i",{staticClass:"isAlive",class:{alive:e.isAlive(e.full(t)),offline:!e.isAlive(e.full(t))}},[e._v(" ")])]),s("i",{directives:[{name:"show",rawName:"v-show",value:e.isApply(e.full(t)),expression:"isApply(full(user))"}],staticClass:"isApply",attrs:{"data-user":e.full(t)},on:{click:function(s){e.sendAgree(e.wrap2(e.full(t)))}}},[e._v("  ")])])})),0)])},b=[],y={name:"User",data:function(){return{color:"red"}},computed:Object(o["a"])(Object(o["a"])({},Object(u["e"])("group",["users","aliveUsers","applyUsers","agreeUsers","newMsgUsers"])),Object(u["c"])("group",["fullName"])),methods:{full:function(e){return e.userName+"@"+e.userID},isNewMsgUser:function(e){return-1!==this.newMsgUsers.indexOf(e)},isAlive:function(e){return-1!==this.aliveUsers.indexOf(e)},isApply:function(e){return-1!==this.applyUsers.indexOf(e)},wrap:function(e){if(-1===this.agreeUsers.indexOf(e)&&-1!==this.aliveUsers.indexOf(e)){var t={type:"/complex/applyConnect",text:'{"sourceUserName": "'+this.fullName+'", "targetUserName": "'+e+'"}'};return t}},wrap2:function(e){var t={type:"/complex/agreeConnect",text:'{"sourceUserName": "'+this.fullName+'", "targetUserName": "'+e+'"}'};return t},sendApply:function(e,t,s){"isApply"!==e.target.className&&-1===this.agreeUsers.indexOf(s)&&-1!==this.aliveUsers.indexOf(s)&&this.$store.dispatch("group/sendApply",t)},sendAgree:function(e){this.$store.dispatch("group/sendAgree",e)}}},I=y,N=(s("9d95"),Object(p["a"])(I,v,b,!1,null,"65183a18",null)),U=N.exports,x=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"privateChatBox"}},[s("div",{attrs:{id:"chatBox"}},[s("ShowBox"),s("UserChooseBox"),s("EditBox")],1)])},O=[],C=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"showBox",attrs:{id:"showBox"},on:{scroll:e.scrollHandler}},e._l(e.totalUsers,(function(t,r){return s("div",{directives:[{name:"show",rawName:"v-show",value:r===e.selected,expression:"index === selected"}],key:t},[s("div",{directives:[{name:"show",rawName:"v-show",value:-1==e.noMsg.indexOf(t)&&e.isTop(),expression:"noMsg.indexOf(totalUser) == -1 && isTop()"}],staticClass:"download"},[s("div",{staticClass:"point"}),s("div",{staticClass:"point"}),s("div",{staticClass:"point"}),s("div",{staticClass:"point"}),s("div",{staticClass:"point"}),s("div",{staticClass:"point"}),s("div",{staticClass:"point"}),s("div",{staticClass:"point"})]),e._l(e.privateMsg[t],(function(r,i){return s("div",{key:i,ref:t,refInFor:!0,class:{oppositeUser:r.sourceID!==e.host.userID,user:r.sourceID===e.host.userID}},[r.sourceID!==e.host.userID?[s("img",{staticClass:"oppositeUserImage",attrs:{src:r.headImageAddress}}),s("span",{staticClass:"oppositeUserName"},[e._v(e._s(r.userNameWithoutId))]),s("br"),s("div",{staticClass:"widthLimit"},[s("i",{staticClass:"triangle"}),s("p",{staticClass:"oppositeUserMessage"},[e._v(" "+e._s(r.message)+" ")])])]:[s("div",{ref:"bind",refInFor:!0,staticClass:"bind"},[s("span",{staticClass:"userName"},[e._v(e._s(r.userNameWithoutId))]),s("img",{staticClass:"userImage",attrs:{src:r.headImageAddress}})]),s("br"),s("div",{ref:"widthLimit",refInFor:!0,staticClass:"widthLimit"},[s("p",{ref:"userMessage",refInFor:!0,staticClass:"userMessage"},[e._v(" "+e._s(r.message)+" ")]),s("i",{staticClass:"triangle"})])]],2)}))],2)})),0)},w=[],D=s("b85c"),_=(s("4de4"),{name:"ShowBox",data:function(){return{firstScroll:[],noMsg:[]}},computed:Object(o["a"])(Object(o["a"])({},Object(u["e"])("group",["agreeUsers","privateMsg","selected","host","room","users"])),Object(u["c"])("group",["totalUsers","fullName"])),methods:Object(o["a"])(Object(o["a"])({},Object(u["d"])("group",["updatePrivateMsgBefore"])),{},{isTop:function(){return 0===this.$refs.showBox.scrollTop&&this.$refs.showBox.scrollHeight!==this.$refs.showBox.clientHeight},style:function(e,t,s){var r=e.offsetWidth+36;r<t.clientWidth?e.style.left=t.clientWidth-r+"px":e.style.width=t.clientWidth-36-20+"px",s.style.left="calc(100% - "+s.clientWidth+"px)"},scrollHandler:function(){this.$refs.showBox;this.isTop()&&-1===this.noMsg.indexOf(this.totalUsers[this.selectedUser])&&this.getData()},getData:function(){var e=this,t=this.totalUsers[this.selected],s=t.substring(t.lastIndexOf("@")+1),r=t.substring(0,t.lastIndexOf("@"));this.$axios.get("http://localhost:8080/list/record",{params:{groupID:this.room.groupID,userID:this.host.userID,oppositeID:s,time:this.privateMsg[t][0].time}}).then((function(i){if(i.data&&i.data.length){var a,o=Object(D["a"])(i.data);try{for(o.s();!(a=o.n()).done;){var n=a.value;n.userNameWithoutId=n.sourceID===s?r:e.host.userName,n.headImageAddress=n.sourceID===s?e.users.filter((function(e){return e.userID===s}))[0].headImageAddress:e.host.headImageAddress,n.sourceName=n.userNameWithoutId+"@"+n.sourceID,n.targetName=(n.targetID===s?r:e.host.userName)+"@"+n.targetID,e.updatePrivateMsgBefore(n)}}catch(c){o.e(c)}finally{o.f()}}else e.noMsg.push(t)}))},wholeStyle:function(){if(-1===this.firstScroll.indexOf(this.totalUsers[this.selected])){this.firstScroll.push(this.totalUsers[this.selected]);var e=this.$refs[this.totalUsers[this.selected]];if(e)for(var t=e.length-1;t>=0;t--){var s=e[t];if("oppositeUser"!==s.className){var r=s.querySelector(".bind"),i=s.querySelector(".widthLimit"),a=i.querySelector(".userMessage");this.style(a,i,r)}}}}}),beforeUpdate:function(){var e=this,t=this.$refs.showBox;t.scrollHeight-t.clientHeight-t.scrollTop<5&&this.$nextTick((function(){t.scrollTop=t.scrollHeight-t.clientHeight,0!==t.scrollTop&&e.wholeStyle()}))},updated:function(){var e=this.$refs[this.totalUsers[this.selected]];if(e)for(var t=e.length-1;t>=0;t--){var s=e[t];if("oppositeUser"!==s.className){if(s.querySelector(".bind").style.left)break;var r=s.querySelector(".bind"),i=s.querySelector(".widthLimit"),a=i.querySelector(".userMessage");this.style(a,i,r)}}}}),k=_,S=(s("4899"),Object(p["a"])(k,C,w,!1,null,null,null)),j=S.exports,A=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"userChooseBox"}},[e._l(e.totalUsers,(function(t,r){return s("button",{key:t,staticClass:"user",class:{selected:e.selected===r,offline:r>e.agreeUsers.length-1},on:{click:function(t){return e.clickSelected(r)}}},[e._v(" "+e._s(t.substring(0,t.lastIndexOf("@")))+" ")])})),s("span",{ref:"laba",staticClass:"laba",on:{click:e.changeMode}},[e._v("")])],2)},M=[],$={name:"UserChooseBox",data:function(){return{public:!1}},computed:Object(o["a"])(Object(o["a"])({},Object(u["e"])("group",["agreeUsers","aliveUsers","newMsgUsers","selected"])),Object(u["c"])("group",["totalUsers"])),methods:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(u["b"])("group",["updateSelected"])),Object(u["d"])("group",["updateNewMsgUsers"])),{},{clickSelected:function(e){var t=this.totalUsers[e],s=this.newMsgUsers.filter((function(e){return e!==t}));this.updateSelected(e),this.updateNewMsgUsers(s)},changeMode:function(){this.public=!this.public;var e="",t="";this.public?(this.$refs.laba.innerText="",e="#0b0c10",t="#fff000"):(this.$refs.laba.innerText="",e="#fff",t="#000"),this.$bus.$emit("choosePublic",this.public),this.$bus.$emit("chooseColor",t),this.$bus.$emit("chooseBackGroundColor",e)}})},E=$,P=(s("6f34"),Object(p["a"])(E,A,M,!1,null,null,null)),T=P.exports,B=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"editBox"}},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.msg,expression:"msg"}],style:{color:e.color,backgroundColor:e.backgroundColor},domProps:{value:e.msg},on:{input:function(t){t.target.composing||(e.msg=t.target.value)}}}),e._v(" "),s("button",{style:{color:e.color},attrs:{id:"close"}},[e._v("关闭")]),s("button",{style:e.color,attrs:{id:"send",disabled:e.isDisabled()},on:{click:e.send}},[e._v(" 发送 ")])])},L=[],R={name:"EditBox",data:function(){return{msg:"",public:!1,color:"#000",backgroundColor:"#fff"}},computed:Object(o["a"])(Object(o["a"])({},Object(u["e"])("group",["host","room","agreeUsers","selected"])),Object(u["c"])("group",["fullName"])),methods:Object(o["a"])(Object(o["a"])({},Object(u["b"])("group",["sendPrivate","sendPublic"])),{},{isDisabled:function(){return(!this.agreeUsers.length||this.selected>this.agreeUsers.length-1)&&!this.public},send:function(){this.public?this.sendPublic(this.wrap2()):this.sendPrivate(this.wrap())},wrap:function(){var e={type:"/complex/sendMessageToUser",text:'{"groupID": "'+this.room.groupID+'", "sourceID": "'+this.host.userID+'", "targetID": "'+this.agreeUsers[this.selected].substring(this.agreeUsers[this.selected].lastIndexOf("@")+1)+'", "time": "'+Date.now()+'", "message": "'+this.msg+'" ,"targetName": "'+this.agreeUsers[this.selected]+'", "sourceName": "'+this.fullName+'", "userNameWithoutId": "'+this.host.userName+'", "headImageAddress": "'+this.host.headImageAddress+'"}'};return e},wrap2:function(){var e={type:"/simple/greeting",text:'{"userName": "'+this.fullName+'","content": "'+this.msg+'"}'};return e},clickBtn:function(){this.public?this.sendPublic(this.wrap2()):this.sendPrivate(this.wrap())}}),mounted:function(){var e=this;this.$bus.$on("choosePublic",(function(t){e.public=t})),this.$bus.$on("chooseColor",(function(t){e.color=t})),this.$bus.$on("chooseBackGroundColor",(function(t){e.backgroundColor=t}))}},W=R,H=(s("e2b7"),Object(p["a"])(W,B,L,!1,null,"12561b9f",null)),J=H.exports,q={name:"PrivateChatBox",components:{ShowBox:j,UserChooseBox:T,EditBox:J}},G=q,F=(s("4547"),Object(p["a"])(G,x,O,!1,null,null,null)),Y=F.exports,z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"publicChatBox"}},[e._m(0),s("div",{ref:"showBox",attrs:{id:"p_showBox"}},e._l(e.msgList,(function(t,r){return s("p",{key:r},[s("span",{staticStyle:{color:"red"}},[e._v(e._s(t.userName+" "))]),s("span",[e._v(e._s(t.content))])])})),0),s("div",{attrs:{id:"extraTool"}},[e._v("额外带扩展窗口")])])},Q=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"laba"}},[s("div",{attrs:{id:"signal"}},[e._v("喇叭")])])}],K={name:"PublicChatBox",data:function(){return{focus:!1}},computed:Object(o["a"])({},Object(u["e"])("group",["msgList"])),methods:{},beforeUpdate:function(){var e=this.$refs.showBox;e.scrollHeight-e.clientHeight-e.scrollTop<5&&this.$nextTick((function(){e.scrollTop=e.scrollHeight-e.clientHeight}))}},V=K,X=(s("b10a"),Object(p["a"])(V,z,Q,!1,null,null,null)),Z=X.exports,ee={name:"Body",components:{User:U,PrivateChatBox:Y,PublicChatBox:Z}},te=ee,se=(s("ed04"),Object(p["a"])(te,g,h,!1,null,null,null)),re=se.exports,ie=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("form",{attrs:{action:"/login",method:"get",id:"login"}},[s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.userID,expression:"userID",modifiers:{trim:!0}}],staticClass:"key",attrs:{type:"text",name:"userID",placeholder:" 账号"},domProps:{value:e.userID},on:{input:function(t){t.target.composing||(e.userID=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),s("br"),s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.password,expression:"password",modifiers:{trim:!0}}],staticClass:"key",attrs:{type:"password",name:"password",placeholder:" 密码"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),s("br"),s("img",{attrs:{id:"verifyCodeImg",src:e.verifyCodeImg},on:{click:e.changeImg}}),s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.verifyCodeStr,expression:"verifyCodeStr",modifiers:{trim:!0}}],attrs:{id:"verifyCodeStr",type:"text",placeholder:"请输入验证码"},domProps:{value:e.verifyCodeStr},on:{input:function(t){t.target.composing||(e.verifyCodeStr=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),s("br"),s("span",{staticStyle:{color:"red"}},[e._v(e._s(e.error))]),s("button",{attrs:{id:"submit",type:"button"},on:{click:e.login}},[e._v("登录")])])])},ae=[],oe=(s("e9c4"),{name:"Login",data:function(){return{userID:"",password:"",verifyCodeStr:"",verifyCodeImg:"http://localhost:8080/login/verifyCodeImg",error:""}},methods:Object(o["a"])(Object(o["a"])({},Object(u["b"])("group",["initHost"])),{},{changeImg:function(){this.verifyCodeImg="http://localhost:8080/login/verifyCodeImg?t="+Date.now()},login:function(){var e=this;this.userID&&this.password?this.verifyCodeStr?this.$axios.get("http://localhost:8080/login/verifyCodeStr",{params:{verifyCodeStr:this.verifyCodeStr}}).then((function(t){console.log(t),t.data?e.$axios.get("http://localhost:8080/login",{params:{userID:e.userID,password:e.password}}).then((function(t){if(t.data&&t.data.userID){if("0"===t.data.userID)return void(e.error="该用户已经登录,请勿重复登录");e.initHost(t.data),localStorage.setItem("login","true"),localStorage.setItem("host",JSON.stringify(t.data)),e.$router.replace({name:"group"})}else e.error="输入的密码和账号错误,请重新输入",e.changeImg()})).catch((function(t){e.error="请求发生异常,请检查网络环境"})):(e.error="验证码输入错误,请重新输入",e.changeImg())})).catch((function(t){e.error="请求发生异常，请检查网络环境"})):alert("请输入验证码"):alert("请输入账号密码")}})}),ne=oe,ce=(s("9fc5"),Object(p["a"])(ne,ie,ae,!1,null,"e35d354a",null)),ue=ce.exports,le=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"head"},[s("img",{attrs:{src:e.host.headImageAddress}}),s("h1",[e._v(e._s(e.host.userName))])]),s("div",{staticClass:"content"},[s("div",{staticClass:"left-menu"},[s("div",{staticClass:"group-menu",on:{click:e.gClick}},[s("div",{staticClass:"menu-head",style:{backgroundColor:e.groupClick?"#FE8333":"#fff"}},[s("img",{staticClass:"menu-head-img-open",style:{display:e.groupClick?"inline-block":"none"},attrs:{src:"image/互动.png"}}),s("img",{staticClass:"menu-head-img-close",style:{display:e.groupClick?"none":"inline-block"},attrs:{src:"image/互动白底.png"}}),s("p",{staticClass:"menu-title"},[e._v("群组")]),s("img",{staticClass:"menu-arrow-open",style:{display:e.groupClick?"inline-block":"none"},attrs:{src:"image/下拉箭头.png"}}),s("img",{staticClass:"menu-arrow-close",style:{display:e.groupClick?"none":"inline-block"},attrs:{src:"image/向右箭头.png"}})]),s("ul",{staticClass:"menu-list",style:{display:e.groupClick?"block":"none"}},[s("li",[s("router-link",{attrs:{to:"/group/block"}},[e._v("我加入的群组")])],1)])]),s("div",{staticClass:"setting-menu",on:{click:e.sClick}},[s("div",{staticClass:"menu-head",style:{backgroundColor:e.settingClick?"#FE8333":"#fff"}},[s("img",{staticClass:"menu-head-img-open",style:{display:e.settingClick?"inline-block":"none"},attrs:{src:"image/设置.png"}}),s("img",{staticClass:"menu-head-img-close",style:{display:e.settingClick?"none":"inline-block"},attrs:{src:"image/设置白底.png"}}),s("p",{staticClass:"menu-title"},[e._v("设置中心")]),s("img",{staticClass:"menu-arrow-open",style:{display:e.settingClick?"inline-block":"none"},attrs:{src:"image/下拉箭头.png"}}),s("img",{staticClass:"menu-arrow-close",style:{display:e.settingClick?"none":"inline-block"},attrs:{src:"image/向右箭头.png"}})]),s("ul",{staticClass:"menu-list",style:{display:e.groupClick?"block":"none"}},[e._m(0)])])]),s("keep-alive",{attrs:{include:"Block"}},[s("router-view")],1)],1)])},de=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",[s("a",{attrs:{href:"#"}},[e._v("账号管理")])])}],pe={name:"Group",data:function(){return{groupClick:!1,settingClick:!1}},computed:Object(o["a"])({},Object(u["e"])("group",["host"])),methods:{gClick:function(){this.groupClick=!this.groupClick},sClick:function(){this.settingClick=!this.settingClick}}},me=pe,fe=(s("a99a"),Object(p["a"])(me,le,de,!1,null,null,null)),ge=fe.exports,he=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Nav"),s("Body")],1)},ve=[],be={name:"Native",components:{Nav:f,Body:re},props:["groupID","leaderID","groupName","headImageAddress"],computed:Object(o["a"])({},Object(u["e"])("group",["host","room","users"])),methods:Object(o["a"])(Object(o["a"])({},Object(u["b"])("group",["initUsers","initRoom","connect","disconnect","destroyData","destroyMsg"])),Object(u["d"])("group",["updatePrivateMsg"])),activated:function(){var e=this,t=!1;this.room.groupID!==this.groupID&&(this.destroyMsg(),t=!0),this.$axios.get("http://localhost:8080/list/user",{params:{userID:this.host.userID,groupID:this.groupID}}).then((function(s){if(s.data){if(e.destroyData(),e.initRoom({groupID:e.groupID,leaderID:e.leaderID,groupName:e.groupName,headImageAddress:e.headImageAddress}),e.initUsers(s.data),t){var r,i=Object(D["a"])(e.users);try{var a=function(){var t=r.value;e.$axios.get("http://localhost:8080/list/record",{params:{groupID:e.room.groupID,userID:e.host.userID,oppositeID:t.userID,time:Date.now()}}).then((function(s){if(s.data&&s.data.length)for(var r=s.data.length-1;r>=0;r--){var i=s.data[r];i.userNameWithoutId=i.sourceID==t.userID?t.userName:e.host.userName,i.headImageAddress=i.sourceID==t.userID?t.headImageAddress:e.host.headImageAddress,i.sourceName=i.userNameWithoutId+"@"+i.sourceID,i.targetName=(i.targetID==t.userID?t.userName:e.host.userName)+"@"+i.targetID,e.updatePrivateMsg(i)}else;}))};for(i.s();!(r=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}}e.connect()}else alert("获取群组列表失败"),e.$router.replace({name:"group"})})).catch((function(t){e.error="请求发生异常，请检查网络环境",e.$router.replace({name:"group"})}))},deactivated:function(){this.destroyData(),this.disconnect()}},ye=be,Ie=Object(p["a"])(ye,he,ve,!1,null,null,null),Ne=Ie.exports,Ue={name:"App",data:function(){return{}},methods:Object(o["a"])({},Object(u["b"])("group",["initHost"])),computed:Object(o["a"])({},Object(u["e"])("group",["host"])),components:{Nav:f,Body:re,Login:ue,Group:ge,Native:Ne},mounted:function(){var e=this;localStorage.getItem("login")&&(this.initHost(JSON.parse(localStorage.getItem("host"))),this.$router.replace({name:"group"})),window.onbeforeunload=function(){e.$store.dispatch("group/disconnect")}}},xe=Ue,Oe=(s("034f"),Object(p["a"])(xe,i,a,!1,null,null,null)),Ce=Oe.exports,we=(s("99af"),{namespaced:!0,actions:{initRoom:function(e,t){e.commit("INITROOM",t)},initHost:function(e,t){e.commit("INITHOST",t)},initUsers:function(e,t){e.commit("INITUSERS",t)},initGroups:function(e,t){e.commit("INITGROUPS",t)},updateSelected:function(e,t){e.commit("UPDATESELECTED",t)},connect:function(e){if(window.WebSocket){var t={};t=new WebSocket("ws://localhost/ws"),t.onopen=function(){t.send(JSON.stringify({type:"/simple/welcome",text:'{"userName": "'+e.getters.fullName+'"}'}))},t.onclose=function(e){},t.onmessage=function(s){var r=JSON.parse(s.data),i=r.type;if("/simple/greeting"===i)e.commit("updateMsgList",r.text);else if("/simple/welcome"===i){if(r.text.userName===e.getters.fullName)return;e.commit("updateAliveUsers",r.text.userName),e.commit("updateMsgList",{userName:r.text.userName+"上线了@",content:""}),t.send(JSON.stringify({type:"/simple/youAreWelcome",text:'{"userName": "'+e.getters.fullName+'"}'}))}else if("/simple/exit"===i){var a=e.getters.totalUsers[e.state.selected];-1!==e.state.agreeUsers.indexOf(r.text.userName)&&(e.commit("updateRecordUsers",r.text.userName),e.commit("updateAgreeUsers",e.state.agreeUsers.filter((function(e){return e!==r.text.userName})))),a===r.text.userName?e.commit("UPDATESELECTED",e.state.agreeUsers.length-1):e.commit("UPDATESELECTED",e.getters.totalUsers.indexOf(a)),e.commit("updateAliveUsers",e.state.aliveUsers.filter((function(e){return e!==r.text.userName}))),e.commit("updateApplyUsers",e.state.applyUsers.filter((function(e){return e!==r.text.userName}))),e.commit("updateMsgList",{userName:r.text.userName+"下线了@",content:""})}else if("/simple/youAreWelcome"===i){if(r.text.userName===e.getters.fullName)return;if(-1!==e.state.aliveUsers.indexOf(r.text.userName))return;e.commit("updateAliveUsers",r.text.userName)}else if(i==="/user/"+e.getters.fullName+"/simple/applyConnect"){if(-1!==e.state.applyUsers.indexOf(r.text.sourceUserName))return;e.commit("updateApplyUsers",r.text.sourceUserName)}else if(i==="/user/"+e.getters.fullName+"/simple/agreeConnect")e.commit("updateRecordUsers",e.state.recordUsers.filter((function(e){return e!==r.text.sourceUserName}))),e.commit("updateApplyUsers",e.state.applyUsers.filter((function(e){return e!==r.text.sourceUserName}))),e.commit("updateAgreeUsers",r.text.sourceUserName);else if(i==="/user/"+e.getters.fullName+"/simple/sendMessageToUser"){if(e.commit("updatePrivateMsg",r.text),r.text.sourceName===e.state.agreeUsers[e.state.selected])return;if(-1!==e.state.newMsgUsers.indexOf(r.text.sourceName))return;e.commit("updateNewMsgUsers",r.text.sourceName)}},e.commit("updateSocket",t)}else alert("该浏览器不支持WebSocket,请更换浏览器重新打开网址")},disconnect:function(e){null!==e.state.socket&&(e.state.socket.send(JSON.stringify({type:"/simple/exit",text:'{"userName": "'+e.getters.fullName+'"}'})),e.state.socket.close())},destroyData:function(e){e.commit("DESTROYDATA")},destroyMsg:function(e){e.commit("DESTROYMSG")},sendPrivate:function(e,t){e.state.socket.send(JSON.stringify(t)),e.commit("updatePrivateMsg",JSON.parse(t.text))},sendPublic:function(e,t){e.state.socket.send(JSON.stringify(t))},sendApply:function(e,t){e.state.socket.send(JSON.stringify(t))},sendAgree:function(e,t){e.state.socket.send(JSON.stringify(t));var s=JSON.parse(t.text).targetUserName;e.commit("deleteApplyUsers",s),e.commit("updateAgreeUsers",s),e.commit("updateRecordUsers",e.state.recordUsers.filter((function(e){return e!==s})))}},mutations:{DESTROYDATA:function(e){e.aliveUsers=[],e.applyUsers=[],e.agreeUsers=[]},DESTROYMSG:function(e){e.msgList=[],e.room={},e.privateMsg={}},UPDATESELECTED:function(e,t){e.selected=t},INITROOM:function(e,t){e.room=t},INITUSERS:function(e,t){e.users=t},INITHOST:function(e,t){e.host=t},INITGROUPS:function(e,t){e.groups=t},updateSocket:function(e,t){e.socket=t},updateMsgList:function(e,t){t.userName=t.userName.substring(0,t.userName.lastIndexOf("@")),e.msgList.push(t)},updateAliveUsers:function(e,t){t instanceof Array?e.aliveUsers=t:e.aliveUsers.push(t)},updateApplyUsers:function(e,t){t instanceof Array?e.applyUsers=t:e.applyUsers.push(t)},deleteApplyUsers:function(e,t){e.applyUsers=e.applyUsers.filter((function(e){return e!==t}))},updateAgreeUsers:function(e,t){t instanceof Array?e.agreeUsers=t:e.agreeUsers.push(t)},updateNewMsgUsers:function(e,t){t instanceof Array?e.newMsgUsers=t:e.newMsgUsers.push(t)},updateRecordUsers:function(e,t){t instanceof Array?e.recordUsers=t:e.recordUsers.push(t)},deleteAgreeUsers:function(e,t){e.agreeUsers=e.agreeUsers.filter((function(e){}))},updatePrivateMsgBefore:function(e,t){console.log(e),console.log(t),t.sourceID!==e.host.userID?e.privateMsg[t.sourceName].unshift(t):e.privateMsg[t.targetName].unshift(t)},updatePrivateMsg:function(e,t){t.sourceID!==e.host.userID?(e.privateMsg[t.sourceName]||r["a"].set(e.privateMsg,t.sourceName,[]),e.privateMsg[t.sourceName].push(t)):(e.privateMsg[t.targetName]||r["a"].set(e.privateMsg,t.targetName,[]),e.privateMsg[t.targetName].push(t))}},state:{host:{},room:{},users:[],groups:[],socket:{},msgList:[],aliveUsers:[],applyUsers:[],agreeUsers:[],recordUsers:[],totalUsers:[],newMsgUsers:[],privateMsg:{},selected:0},getters:{fullName:function(e){return e.host.userName+"@"+e.host.userID},totalUsers:function(e){return e.agreeUsers.concat(e.recordUsers)}}});r["a"].use(u["a"]);var De=new u["a"].Store({modules:{group:we}}),_e=s("bc3a"),ke=s.n(_e),Se=s("8c4f"),je=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"b"},[s("div",{staticStyle:{height:"50px","line-height":"50px"}},[s("h1",{staticClass:"ti"},[e._v("我加入的群组")]),s("p",{staticClass:"join-total"},[e._v(e._s(e.groups.length))])]),s("hr"),""!=e.msg?s("h1",{staticClass:"msg"},[e._v(e._s(e.msg))]):e._e(),e._l(e.groups,(function(t){return s("div",{key:t.groupID,staticClass:"g"},[s("router-link",{attrs:{to:{name:"native",query:{groupID:t.groupID,leaderID:t.leaderID,groupName:t.groupName,headImageAddress:t.headImageAddress}}}},[s("img",{attrs:{src:t.headImageAddress}})]),s("router-link",{attrs:{to:{name:"native",query:{groupID:t.groupID,leaderID:t.leaderID,groupName:t.groupName,headImageAddress:t.headImageAddress}}}},[s("h1",[e._v(e._s(t.groupName))])])],1)}))],2)},Ae=[],Me={name:"Block",data:function(){return{msg:"",init:!1}},methods:Object(o["a"])({},Object(u["b"])("group",["initGroups"])),computed:Object(o["a"])({},Object(u["e"])("group",["groups","host","users"])),activated:function(){var e=this;this.init||this.$axios.get("http://localhost:8080/list/group",{params:{userID:this.host.userID}}).then((function(t){t.data?e.initGroups(t.data):e.msg="你没有加入任何群组",e.init=!0})).catch((function(t){e.msg="请求出现异常,请检查网络环境"}))}},$e=Me,Ee=(s("c4e0"),Object(p["a"])($e,je,Ae,!1,null,"36376cfb",null)),Pe=Ee.exports;r["a"].use(Se["a"]);var Te=new Se["a"]({routes:[{name:"login",path:"/login",component:ue},{name:"native",path:"/native",component:Ne,props:function(e){return{groupID:e.query.groupID,leaderID:e.query.leaderID,groupName:e.query.groupName,headImageAddress:e.query.headImageAddress}},beforeEnter:function(e,t,s){sessionStorage.getItem("login")&&"true"===sessionStorage.getItem("login")?s():alert("请先登录")}},{name:"group",path:"/group",component:ge,children:[{name:"block",path:"block",component:Pe}],beforeEnter:function(e,t,s){sessionStorage.getItem("login")&&"true"===sessionStorage.getItem("login")?s():alert("请先登录")}}]}),Be=Te;r["a"].config.productionTip=!1,new r["a"]({el:"#app",store:De,render:function(e){return e(Ce)},router:Be,beforeCreate:function(){r["a"].prototype.$bus=this,r["a"].prototype.$axios=ke.a}})},"58de":function(e,t,s){},"5b49":function(e,t,s){"use strict";s("58de")},"6e32":function(e,t,s){},"6f34":function(e,t,s){"use strict";s("9d09")},"85ec":function(e,t,s){},"9c5e":function(e,t,s){},"9d09":function(e,t,s){},"9d95":function(e,t,s){"use strict";s("9c5e")},"9fc5":function(e,t,s){"use strict";s("e829")},a99a:function(e,t,s){"use strict";s("cbf4")},b10a:function(e,t,s){"use strict";s("6e32")},b1ab:function(e,t,s){},c4e0:function(e,t,s){"use strict";s("3fd0")},cbf4:function(e,t,s){},db6a:function(e,t,s){},e2b7:function(e,t,s){"use strict";s("fea3")},e829:function(e,t,s){},ed04:function(e,t,s){"use strict";s("db6a")},f0ee:function(e,t,s){},fea3:function(e,t,s){}});
//# sourceMappingURL=index.e805f3ab.js.map